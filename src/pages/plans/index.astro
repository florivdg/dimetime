---
import Layout from '@/layouts/Layout.astro'
import Dashboard from '@/components/Dashboard.vue'
import PlanManager from '@/components/plans/PlanManager.vue'
import { getAllPlans, getAvailableYears } from '@/lib/plans'

const currentYear = new Date().getFullYear()
const availableYears = await getAvailableYears()

// Default to current year if plans exist for it, otherwise show all
const initialYear = availableYears.includes(currentYear)
  ? currentYear
  : undefined
const plans = await getAllPlans(true, initialYear)
---

<Layout>
  <Dashboard
    client:load
    currentPath={Astro.url.pathname}
    breadcrumbs={[{ label: 'Pläne' }]}
  >
    <div class="flex flex-1 flex-col gap-4">
      <div class="flex items-center justify-between">
        <h1 class="text-2xl font-semibold tracking-tight">Pläne</h1>
      </div>
      <PlanManager
        client:load
        initialPlans={plans}
        availableYears={availableYears}
        initialYear={initialYear}
      />
    </div>
  </Dashboard>
</Layout>
